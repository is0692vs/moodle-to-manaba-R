<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moodle Demo - マイページ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .course-info-container { transition: all 0.3s ease; }
        .coursename a { font-weight: 600; color: #0f6fc5; text-decoration: none; }
        .coursename a:hover { text-decoration: underline; }
        .card-body { padding: 1rem; }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand">Moodle Demo</span>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>マイコース</h2>
        
        <div id="block-myoverview-demo" class="block-myoverview block-cards">
            <div data-region="courses-view" data-display="card">
                <div data-region="course-view-content">
                    <!-- コースカードをここに動的挿入 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        function loadCourseCards() {
            const container = document.querySelector('[data-region="course-view-content"]');
            
            const courseData = [
                { id: '12345', name: '52103:スポーツ方法実習Ⅱ(C)(24)', summary: '秋セメスタ－・金1(1-2)' },
                { id: '12346', name: '51201:プログラミング基礎I(A)(24)', summary: '秋セメスタ－・火2' },
                { id: '12347', name: '50105:数学解析I(B)(24)', summary: '秋セメスタ－・月3' },
                { id: '12348', name: '53301:英語コミュニケーション(D)(24)', summary: '秋セメスタ－・水1' }
            ];

            courseData.forEach(course => {
                const card = document.createElement('article');
                card.setAttribute('data-region', 'course');
                card.className = 'card course-info-container mb-3';
                
                card.innerHTML = `
                    <div class="card-body">
                        <div data-region="course-name" class="coursename">
                            <a class="aalink" href="https://lms.ritsumei.ac.jp/course/view.php?id=${course.id}">
                                ${course.name}
                            </a>
                        </div>
                        <div class="mt-2">
                            <small class="text-muted">${course.summary}</small>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            console.log('[Demo] Course cards loaded');
        }

        // Mock fetch for course details
        const mockCourseDetails = {
            '12345': '<section class="block_course_summary"><div class="text_to_html">秋セメスタ－・金1(1-2)<br>金1:トレーニングルーム</div></section>',
            '12346': '<section class="block_course_summary"><div class="text_to_html">秋セメスタ－・火2<br>火2:コンピュータ演習室1</div></section>',
            '12347': '<section class="block_course_summary"><div class="text_to_html">秋セメスタ－・月3<br>月3:第1講義室</div></section>',
            '12348': '<section class="block_course_summary"><div class="text_to_html">秋セメスタ－・水1<br>水1:語学演習室2</div></section>'
        };

        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            if (url.includes('course/view.php?id=')) {
                const courseId = url.match(/id=(\d+)/)[1];
                const mockHtml = mockCourseDetails[courseId] || '';
                
                return Promise.resolve({
                    ok: true,
                    text: () => Promise.resolve(`<!DOCTYPE html><html><body>${mockHtml}</body></html>`)
                });
            }
            return originalFetch.call(this, url, options);
        };

        setTimeout(() => { loadCourseCards(); }, 1000);
    </script>
</body>
</html>